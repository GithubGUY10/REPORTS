import java.io.FileWriter;
import java.io.IOException;
 
 /**
 * The ReportGenerator class handles the generation of various financial reports
 * including monthly summaries, annual reports, and category-specific reports.
 * It can also export report data to CSV format and display results.
 * @author
 * Iman Hamby
 * */
 
public class ReportGenerator {

    /**
    * This is a placeholder constructor
    * */ 
    public ReportGenerator(){
        this.year = 2025;
        this.userName = "User Sample";
        this.totalIncome = 0.0;
        this.totalExpenses = 0.0;
        this.categories = new String[] {"Home", "Food", "Work", "Entertainment"};
    }
    /**
     * The year for which the report is being generated.
     * @author 
     * Arif Hossain
     */
    private int year;

    /**
     * The name of the user for whom the report is generated.
     * @author 
     * Arif Hossain
     */
    private String userName;

    /**
     * The total income recorded for the reporting period.
     * @author 
     * Arif Hossain
     */
    private double totalIncome;

    /**
     * The total expenses recorded for the reporting period.
     * @author 
     * Arif Hossain
     */
    private double totalExpenses;

    /**
     * The categories used for organizing expenses and income.
     * @author 
     * Arif Hossain
     */
    private String[] categories;

    /**
     * Generates a summary report of financial data for each month in the year.
     * 
     * @return A String representing the monthly financial summary report.
     * @author 
     * Wajih Chowdhury
     */
    public String generateMonthlySummary() {
        double[] monthlyIncome = {2500, 2800, 2700, 3000, 2600, 2900};
        double[] monthlyExpenses = {1500, 1600, 1450, 1800, 1550, 1700};

        ReportFormatter formatter = new ReportFormatter();

        String[][] table = new String[monthlyIncome.length + 1][4];
        table[0][0] = "Month";
        table[0][1] = "Income";
        table[0][2] = "Expenses";
        table[0][3] = "Net";

        totalIncome = 0.0;
        totalExpenses = 0.0;

        for (int i = 0; i < monthlyIncome.length; i++) {
            double income = monthlyIncome[i];
            double expenses = monthlyExpenses[i];
            double net = income - expenses;

            totalIncome += income;
            totalExpenses += expenses;

            table[i + 1][0] = String.valueOf(i + 1);
            table[i + 1][1] = formatter.formatCurrency(income);
            table[i + 1][2] = formatter.formatCurrency(expenses);
            table[i + 1][3] = formatter.formatCurrency(net);
        }

        String header = formatter.formatHeader(year, "Monthly");
        return header + "\n" + formatter.alignColumns(table);
    }

    /**
     * Generates a comprehensive financial report for the entire year,
     * summarizing income, expenses, and overall balance.
     * 
     * @return formatted annual report string
     * @author 
     * Wajih Chowdhury
     */
    public String generateAnnualReport() {
        
        if (totalIncome == 0.0 && totalExpenses == 0.0) {
            generateMonthlySummary();
        }

        double balance = totalIncome - totalExpenses;

        ReportFormatter formatter = new ReportFormatter();

        StringBuilder report = new StringBuilder();
        report.append(formatter.formatHeader(year, "Annual")).append("\n\n");
        report.append("User: ").append(userName).append("\n\n");
        report.append("Total Income:   ").append(formatter.formatCurrency(totalIncome)).append("\n");
        report.append("Total Expenses: ").append(formatter.formatCurrency(totalExpenses)).append("\n");
        report.append("Net Balance:    ").append(formatter.formatCurrency(balance)).append("\n");

        return report.toString();
    }

    /**
     * Generates a financial report grouped by categories, showing total amounts
     * spent or earned for each category.
     * 
     * @return A String representing the category-based financial report.
     * @author 
     * Wajih Chowdhury
     */
    public String generateCategoryReport() {

        String[] localCategories = {"Home", "Food", "Work", "Entertainment"};
        double[] categoryTotals = {1200, 800, 450, 600};

        ReportFormatter formatter = new ReportFormatter();

        String[][] table = new String[localCategories.length + 1][2];
        table[0][0] = "Category";
        table[0][1] = "Total";

        for (int i = 0; i < localCategories.length; i++) {
            table[i + 1][0] = localCategories[i];
            table[i + 1][1] = formatter.formatCurrency(categoryTotals[i]);
        }

        String header = formatter.formatHeader(year, "Category");
        return header + "\n" + formatter.alignColumns(table);
    }

    /**
     * Exports the annual report to a CSV-like text file.
     *
     * @param filename the file to export to
     * @return true if export succeeded, false otherwise
     * @author 
     * Wajih Chowdhury
     */
    public boolean exportToCSV(String filename) {
        try (FileWriter writer = new FileWriter(filename)) {

            String annual = generateAnnualReport();
            String[] lines = annual.split("\n");

            for (String line : lines) {
                String csv = line.replaceAll("\\s{2,}", ",");
                writer.write(csv + "\n");
            }

            return true;

        } catch (IOException e) {
            return false;
        }
    }

    /**
     * Displays all report types to the console in order.
     *
     * @author 
     * Wajih Chowdhury
     */
    public void displayResults() {
        System.out.println(generateMonthlySummary());
        System.out.println();
        System.out.println(generateAnnualReport());
        System.out.println();
        System.out.println(generateCategoryReport());
    }
}

/**
 * The ReportFormatter class provides utility methods for formatting financial reports,
 * including currency formatting, text alignment, and report headers.
 * 
 * @author 
 * Wajih Chowdhury
 */
class ReportFormatter {
   /**
    * Private constructor for a static class.
    * @author Arif Hossain
    */
   private ReportFormatter() {}
   /**
    * The currency symbol used for formatting monetary values.
    * @author Arif Hossain
    */
   private static char symbolCurrency = '$';

   /**
    * The default width used for report table columns.
    * @author Arif Hossain
    */
   private int columnWidth = 15;

   /**
    * Formats a numerical value into a currency string representation.
    * 
    * @param amount The amount to be formatted.
    * @return A formatted String representing the amount as currency (e.g., "$123.45").
    * @author Arif Hossain
    */
   public static String formatCurrency(double amount) {
       return String.format("%s%.2f", symbolCurrency, amount);
   }

   /**
    * Aligns data into columns of a specified width for table-like display.
    * 
    * @param data A 2D array of Strings containing the data to align in columns.
    * @return A formatted String representing the aligned table data.
    * @author Arif Hossain
    */
   public static String alignColumns(String[][] data) {
	   String output = "";
	   for (String[] col : data) {
		   for (String item : col) {
			   output.concat(item + "\t");
		   }
		   output.concat("\n");
	   }
       return null;
   }

   /**
    * Creates a formatted header for a report that includes the year and type of report.
    * 
    * @param year The year for which the report is generated.
    * @param reportType The type of report (e.g., "Annual", "Monthly").
    * @return A formatted String representing the report header section.
    * @author Arif Hossain
    */
   public static String formatHeader(int year, String reportType) {
       return String.format("%s Report for %d", reportType, year);
   }
}
